{
	"info": {
		"_postman_id": "0b3706b0-d046-476d-8520-74107ab6a76a",
		"name": "byop_new_validity baypass getByopPrice",
		"description": "newman run \"byop_new_validity_addOn.json\" -d \"dataFile_source_byop_1415d_addOn.csv\" -r htmlextra --reporter-htmlextra-export \"byop_Report.html\" --reporter-htmlextra-title \"SIT - Suka-Suka MCCM Market Reparation\"",
		"schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json",
		"_exporter_id": "19473299"
	},
	"item": [
		{
			"name": "getByopPrice_main",
			"event": [
				{
					"listen": "prerequest",
					"script": {
						"exec": [
							"// pm.environment.set(\"entity_id\", 1232153247);\r",
							"// pm.environment.set(\"url_byop\", \"http://10.23.40.58:9321\");\r",
							"// pm.environment.set(\"validity\", \"14\");\r",
							"// pm.environment.set(\"quota_byop\", \"8\");\r",
							"// pm.environment.set(\"quotaUnit_byop\", \"GB\");\r",
							"// pm.environment.set(\"tc\", \"1\");\r",
							"// pm.environment.set(\"basePrice\", \"27500\");\r",
							"// pm.environment.set(\"minPrice\", \"0\");;\r",
							"// pm.environment.set(\"maxPrice\", \"24750\");\r",
							"\r",
							"pm.environment.set(\"entity_id\", pm.iterationData.get(\"entity_id\"));\r",
							"pm.environment.set(\"url_byop\", pm.iterationData.get(\"url_byop\"));\r",
							"pm.environment.set(\"validity\", pm.iterationData.get(\"validity\"));\r",
							"pm.environment.set(\"quota_byop\", pm.iterationData.get(\"quota_byop\"));\r",
							"pm.environment.set(\"quotaUnit_byop\", pm.iterationData.get(\"quotaUnit_byop\"));\r",
							"pm.environment.set(\"tc\", pm.iterationData.get(\"tc\"));\r",
							"pm.environment.set(\"basePrice\", pm.iterationData.get(\"basePrice\"));\r",
							"pm.environment.set(\"minPrice\", pm.iterationData.get(\"minPrice\"));\r",
							"pm.environment.set(\"maxPrice\", pm.iterationData.get(\"maxPrice\"));"
						],
						"type": "text/javascript",
						"packages": {},
						"requests": {}
					}
				},
				{
					"listen": "test",
					"script": {
						"exec": [
							"var jsonData = pm.response.json();\r",
							"\r",
							"// ambil expected dari ENV\r",
							"        const tc = pm.environment.get(\"tc\");\r",
							"        const expname= pm.environment.get(\"name\");\r",
							"        const expquota_byop = Number(pm.environment.get(\"quota_byop\"));\r",
							"        const expquotaUnit_byop = pm.environment.get(\"quotaUnit_byop\");\r",
							"        const expValidity  = Number(pm.environment.get(\"validity\"));\r",
							"        const explistPrice = Number(pm.environment.get(\"basePrice\"));\r",
							"        const minPrice     = Number(pm.environment.get(\"minPrice_byop\"));\r",
							"        const maxPrice     = Number(pm.environment.get(\"maxPrice_byop\"));\r",
							"\r",
							"pm.test(`TC${tc} Verify Base Price of ${expquota_byop}${expquotaUnit_byop} Suka-Suka ${expValidity}D`, function () {\r",
							"let errors = [];\r",
							"\r",
							"    // cek response null / undefined / empty\r",
							"    if (!jsonData || jsonData.length === 0) {\r",
							"        errors.push(`null`);\r",
							"    } else {\r",
							"\r",
							"       \r",
							"var subs_id = jsonData.SUBSCRIBER_ID;\r",
							"var msisdn = jsonData.MSISDN;\r",
							"var validity = jsonData.validity\r",
							"var offerId = jsonData.offerId;\r",
							"var listPrice = jsonData.listPrice;\r",
							"var finalPrice = jsonData.finalPrice;\r",
							"var discount = jsonData.discount;\r",
							"var summary = jsonData.summary||[];\r",
							"\r",
							"\r",
							"var finalPrice_utama = summary[0].price\r",
							"\r",
							"var viewTable = []\r",
							"\r",
							"    let newObj = {\r",
							"        \"name\": summary[0].name,\r",
							"        \"quota\": summary[0].quota,\r",
							"        \"quotaUnits\": summary[0].quotaUnits,\r",
							"        \"listPrice\": listPrice,\r",
							"        \"finalPrice\": finalPrice,\r",
							"        \"discount\": discount,\r",
							"        \"price\": summary[0].price,\r",
							"        \"validity\": validity\r",
							"    }\r",
							"    viewTable.push(newObj)\r",
							"\r",
							"\r",
							"\r",
							"\r",
							"var template = `\r",
							"<style type=\"text/css\">\r",
							"    .tftable {font-size:14px;color:#333333;width:100%;border-width: 1px;border-color: #87ceeb;border-collapse: collapse;}\r",
							"    .tftable th {font-size:18px;background-color:#87ceeb;border-width: 1px;padding: 8px;border-style: solid;border-color: #87ceeb;text-align:left;}\r",
							"    .tftable tr {background-color:#ffffff;}\r",
							"    .tftable td {font-size:14px;border-width: 1px;padding: 8px;border-style: solid;border-color: #87ceeb;}\r",
							"    .tftable tr:hover {background-color:#e0ffff;}\r",
							"</style>\r",
							"\r",
							"<table class=\"tftable\" border=\"1\">\r",
							"    <tr>\r",
							"        \r",
							"        <th>Name</th>\r",
							"        <th>Quota</th>\r",
							"        <th>Quota Units</th>\r",
							"        <th>List Price</th>\r",
							"        <th>Final Price</th>\r",
							"        <th>Discount</th>\r",
							"        <th>Disc Price</th>\r",
							"        <th>Validity</th>\r",
							"        \r",
							"    </tr>\r",
							"    \r",
							"    {{#each response}}\r",
							"    <tr>\r",
							"        <td>{{name}}</td>\r",
							"        <td>{{quota}}</td>\r",
							"        <td>{{quotaUnits}}</td>\r",
							"        <td>{{listPrice}}</td>\r",
							"        <td>{{finalPrice}}</td>\r",
							"        <td>{{discount}}</td>\r",
							"        <td>{{price}}</td>\r",
							"        <td>{{validity}}</td>\r",
							"     </tr>\r",
							"    {{/each}}\r",
							"   \r",
							"    \r",
							"    \r",
							"</table>\r",
							" \r",
							"`;\r",
							"\r",
							"pm.visualizer.set(template, {\r",
							"    response: viewTable\r",
							"});\r",
							"    \r",
							"   \r",
							"    summary.forEach(item => {    \r",
							"\r",
							"\r",
							"        // 1. quota_byop\r",
							"        if (item.quota !== expquota_byop) {\r",
							"            errors.push(\r",
							"                `check quota_byop: quota_byop mismatch (resp=${item.quota}, exp=${expquota_byop})`\r",
							"            );\r",
							"        }\r",
							"\r",
							"        // 2. quotaUnit_byop\r",
							"        if (item.quotaUnits !== expquotaUnit_byop) {\r",
							"            errors.push(\r",
							"                `check quotaUnits_byop: quotaUnits_byop mismatch (resp=${item.quotaUnits}, exp=${expquotaUnit_byop})`\r",
							"            );\r",
							"        }\r",
							"\r",
							"\r",
							"        // 3. validity\r",
							"        if (validity !== expValidity) {\r",
							"            errors.push(\r",
							"                `check validity: validity mismatch (resp=${validity}, exp=${expValidity})`\r",
							"            );\r",
							"        }\r",
							"\r",
							"        // 4. listPrice\r",
							"        if (listPrice !== explistPrice) {\r",
							"            errors.push(\r",
							"                `check base price: listPrice mismatch (resp=${listPrice}, exp=${explistPrice})`\r",
							"            );\r",
							"        }\r",
							"\r",
							"        // 5. finalPrice range\r",
							"        if (finalPrice < minPrice || finalPrice > maxPrice) {\r",
							"            errors.push(\r",
							"                `check finalPrice: finalPrice out of range (resp=${finalPrice}, range=${minPrice}-${maxPrice})`\r",
							"            );\r",
							"        }\r",
							"\r",
							"        // 6. disc_price range\r",
							"        if (item.price < minPrice || item.price > maxPrice) {\r",
							"            errors.push(\r",
							"                `check disc_price: disc_price out of range (resp=${item.price}, range=${minPrice}-${maxPrice})`\r",
							"            );\r",
							"        }\r",
							"\r",
							"        // 7. discount percentage validation\r",
							"        // 7. discount percentage validation\r",
							"        const respDiscount = Number(discount);\r",
							"        const expectedDiscount = Number((((listPrice - finalPrice) / listPrice) * 100).toFixed(2));\r",
							"\r",
							"const tolerance = 0.01;\r",
							"\r",
							"if (Math.abs(respDiscount - expectedDiscount) > tolerance) {\r",
							"    errors.push(\r",
							"        `check disc prcn: discount mismatch (resp=${respDiscount}%, expected=${expectedDiscount}%)`\r",
							"    );\r",
							"}\r",
							"    });\r",
							"\r",
							"}\r",
							"    \r",
							"\r",
							"     if (errors.length > 0) {\r",
							"    pm.expect.fail(\r",
							"        \"\\n\" +\r",
							"        (errors.length === 1\r",
							"            ? errors[0]\r",
							"            : errors.map((e, i) => `${i + 1}. ${e}`).join(\"\\n\")\r",
							"        )\r",
							"    );\r",
							"}\r",
							"\r",
							"});\r",
							"\r",
							"\r",
							"\r",
							""
						],
						"type": "text/javascript",
						"packages": {},
						"requests": {}
					}
				}
			],
			"protocolProfileBehavior": {
				"disableBodyPruning": true
			},
			"request": {
				"method": "GET",
				"header": [],
				"body": {
					"mode": "raw",
					"raw": "{ \r\n    \"templateName\": \"AxisByop\",\r\n    \"location_id\": \"\",\r\n    \"stepName\": \"Confirm\",\r\n    \"validity\": \"{{validity}}\",\r\n    \"bucketSpec\": [\r\n        {\r\n            \"name\": \"utama\",\r\n            \"quota\": \"{{quota_byop}}\",\r\n            \"quotaUnits\": \"{{quotaUnit_byop}}\"\r\n        }\r\n        \r\n    ],\r\n    \"addOns\": []\r\n}\r\n",
					"options": {
						"raw": {
							"language": "json"
						}
					}
				},
				"url": {
					"raw": "{{url_byop}}/getByopPrice/?SUBSCRIBER_ID={{entity_id}}&CHANNEL_NAME=AxisNetByop",
					"host": [
						"{{url_byop}}"
					],
					"path": [
						"getByopPrice",
						""
					],
					"query": [
						{
							"key": "SUBSCRIBER_ID",
							"value": "{{entity_id}}"
						},
						{
							"key": "CHANNEL_NAME",
							"value": "AxisNetByop"
						}
					]
				}
			},
			"response": []
		},
		{
			"name": "getByopPrice_addOn",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"var utamaBasePrice = 27500\r",
							"var jsonData = pm.response.json();\r",
							"\r",
							"// ambil expected dari ENV\r",
							"        const tc = pm.environment.get(\"tc\");\r",
							"        const expname= pm.environment.get(\"name\");\r",
							"        const expquota_addOn = Number(pm.environment.get(\"quota_addOn\"));\r",
							"        const expquotaUnit_addOn = pm.environment.get(\"quotaUnit_addOn\");\r",
							"        const expValidity  = Number(pm.environment.get(\"validity\"));\r",
							"        const explistPrice = Number(pm.environment.get(\"basePrice_addOn\")) + utamaBasePrice;\r",
							"        const minPrice     = Number(pm.environment.get(\"minPrice_addOn\"));\r",
							"        const maxPrice     = Number(pm.environment.get(\"maxPrice_addOn\"));\r",
							"\r",
							"pm.test(`TC${tc} Verify Base Price of ${expquota_addOn}${expquotaUnit_addOn} addOn ${expname}`, function () {\r",
							"let errors = [];\r",
							"\r",
							"    // cek response null / undefined / empty\r",
							"    if (!jsonData || jsonData.length === 0) {\r",
							"        errors.push(`null`);\r",
							"    } else {\r",
							"\r",
							"var subs_id = jsonData.SUBSCRIBER_ID;\r",
							"var msisdn = jsonData.MSISDN;\r",
							"var validity = jsonData.validity\r",
							"var offerId = jsonData.offerId;\r",
							"var listPrice = jsonData.listPrice;\r",
							"var finalPrice = jsonData.finalPrice;\r",
							"var discount = jsonData.discount;\r",
							"var summary = jsonData.summary||[];\r",
							"const item = summary[1]\r",
							"\r",
							"var finalPrice_utama = summary[1].price\r",
							"\r",
							"var viewTable = []\r",
							"\r",
							"    let newObj = {\r",
							"        \"name\": summary[1].name,\r",
							"        \"quota\": summary[1].quota,\r",
							"        \"quotaUnits\": summary[1].quotaUnits,\r",
							"        \"listPrice\": listPrice,\r",
							"        \"finalPrice\": finalPrice,\r",
							"        \"discount\": discount,\r",
							"        \"price\": summary[1].price,\r",
							"        \"validity\": validity\r",
							"    }\r",
							"    viewTable.push(newObj)\r",
							"\r",
							"\r",
							"\r",
							"\r",
							"var template = `\r",
							"<style type=\"text/css\">\r",
							"    .tftable {font-size:14px;color:#333333;width:100%;border-width: 1px;border-color: #87ceeb;border-collapse: collapse;}\r",
							"    .tftable th {font-size:18px;background-color:#87ceeb;border-width: 1px;padding: 8px;border-style: solid;border-color: #87ceeb;text-align:left;}\r",
							"    .tftable tr {background-color:#ffffff;}\r",
							"    .tftable td {font-size:14px;border-width: 1px;padding: 8px;border-style: solid;border-color: #87ceeb;}\r",
							"    .tftable tr:hover {background-color:#e0ffff;}\r",
							"</style>\r",
							"\r",
							"<table class=\"tftable\" border=\"1\">\r",
							"    <tr>\r",
							"        \r",
							"        <th>Name</th>\r",
							"        <th>Quota</th>\r",
							"        <th>Quota Units</th>\r",
							"        <th>List Price</th>\r",
							"        <th>Final Price</th>\r",
							"        <th>Discount</th>\r",
							"        <th>Disc Price</th>\r",
							"        <th>Validity</th>\r",
							"        \r",
							"    </tr>\r",
							"    \r",
							"    {{#each response}}\r",
							"    <tr>\r",
							"        <td>{{name}}</td>\r",
							"        <td>{{quota}}</td>\r",
							"        <td>{{quotaUnits}}</td>\r",
							"        <td>{{listPrice}}</td>\r",
							"        <td>{{finalPrice}}</td>\r",
							"        <td>{{discount}}</td>\r",
							"        <td>{{price}}</td>\r",
							"        <td>{{validity}}</td>\r",
							"     </tr>\r",
							"    {{/each}}\r",
							"   \r",
							"    \r",
							"    \r",
							"</table>\r",
							" \r",
							"`;\r",
							"\r",
							"pm.visualizer.set(template, {\r",
							"    response: viewTable\r",
							"});\r",
							"\r",
							"     \r",
							"        // 1. quota_addOn\r",
							"        if (item.quota !== expquota_addOn) {\r",
							"            errors.push(\r",
							"                `check quota_addOn: quota_addOn mismatch (resp=${item.quota}, exp=${expquota_addOn})`\r",
							"            );\r",
							"        }\r",
							"\r",
							"        // 2. quotaUnit_addOn\r",
							"        if (item.quotaUnits !== expquotaUnit_addOn) {\r",
							"            errors.push(\r",
							"                `check quotaUnits_addOn: quotaUnits_addOn mismatch (resp=${item.quotaUnits}, exp=${expquotaUnit_addOn})`\r",
							"            );\r",
							"        }\r",
							"\r",
							"\r",
							"        // 3. validity\r",
							"        if (validity !== expValidity) {\r",
							"            errors.push(\r",
							"                `check validity: validity mismatch (resp=${validity}, exp=${expValidity})`\r",
							"            );\r",
							"        }\r",
							"\r",
							"        // 4. listPrice\r",
							"        if (listPrice !== explistPrice) {\r",
							"            errors.push(\r",
							"                `check addOn base price: listPrice mismatch (resp=${listPrice}, exp=${explistPrice})`\r",
							"            );\r",
							"        }\r",
							"\r",
							"        // 5. finalPrice range\r",
							"        if (Number(finalPrice) !== Number((summary[0].price)+summary[1].price)) {\r",
							"            errors.push(\r",
							"                `check addOn finalPrice: (resp=${finalPrice}, doesn't match disc price sum =${(summary[0].price)}+${(summary[1].price)})`\r",
							"            );\r",
							"        }\r",
							"\r",
							"        // 6. disc_price range\r",
							"        if (item.price < minPrice || item.price > maxPrice) {\r",
							"            errors.push(\r",
							"                `check disc_price: disc_price out of range (resp=${item.price}, range=${minPrice}-${maxPrice})`\r",
							"            );\r",
							"        }\r",
							"\r",
							"        // 7. discount percentage validation\r",
							"        const respDiscount = Number(discount);\r",
							"        const expectedDiscount = Number((((listPrice - finalPrice) / listPrice) * 100).toFixed(2));\r",
							"\r",
							"const tolerance = 0.01;\r",
							"\r",
							"if (Math.abs(respDiscount - expectedDiscount) > tolerance) {\r",
							"    errors.push(\r",
							"        `check disc prcn: discount mismatch (resp=${respDiscount}%, expected=${expectedDiscount}%)`\r",
							"    );\r",
							"}\r",
							"        \r",
							"    \r",
							"\r",
							"   \r",
							"    }\r",
							"\r",
							"    if (errors.length > 0) {\r",
							"    pm.expect.fail(\r",
							"        \"\\n\" +\r",
							"        (errors.length === 1\r",
							"            ? errors[0]\r",
							"            : errors.map((e, i) => `${i + 1}. ${e}`).join(\"\\n\")\r",
							"        )\r",
							"    );\r",
							"}\r",
							"});\r",
							"\r",
							"\r",
							"\r",
							""
						],
						"type": "text/javascript",
						"packages": {},
						"requests": {}
					}
				},
				{
					"listen": "prerequest",
					"script": {
						"exec": [
							"// pm.environment.set(\"entity_id\", 1232153247);\r",
							"// pm.environment.set(\"url_byop\", \"http://10.23.40.58:9321\");\r",
							"// pm.environment.set(\"validity\", \"14\");\r",
							"// pm.environment.set(\"name\", \"sosmed\");\r",
							"// pm.environment.set(\"quota_addOn\", \"1\");\r",
							"// pm.environment.set(\"quotaUnit_addOn\", \"GB\");\r",
							"// pm.environment.set(\"tc\", \"16\");\r",
							"// pm.environment.set(\"basePrice_addOn\", \"4200\");\r",
							"// pm.environment.set(\"minPrice_addOn\", \"49000\");\r",
							"// pm.environment.set(\"maxPrice_addOn\", \"49000\");\r",
							"\r",
							"pm.environment.set(\"entity_id\", pm.iterationData.get(\"entity_id\"));\r",
							"pm.environment.set(\"url_byop\", pm.iterationData.get(\"url_byop\"));\r",
							"pm.environment.set(\"validity\", pm.iterationData.get(\"validity\"));\r",
							"pm.environment.set(\"quota_addOn\", pm.iterationData.get(\"quota_addOn\"));\r",
							"pm.environment.set(\"name\", pm.iterationData.get(\"name\"));\r",
							"pm.environment.set(\"quotaUnit_addOn\", pm.iterationData.get(\"quotaUnit_addOn\"));\r",
							"pm.environment.set(\"tc\", pm.iterationData.get(\"tc\"));\r",
							"pm.environment.set(\"basePrice_addOn\", pm.iterationData.get(\"basePrice_addOn\"));\r",
							"pm.environment.set(\"minPrice_addOn\", pm.iterationData.get(\"minPrice_addOn\"));\r",
							"pm.environment.set(\"maxPrice_addOn\", pm.iterationData.get(\"maxPrice_addOn\"));"
						],
						"type": "text/javascript",
						"packages": {},
						"requests": {}
					}
				}
			],
			"protocolProfileBehavior": {
				"disableBodyPruning": true
			},
			"request": {
				"method": "GET",
				"header": [],
				"body": {
					"mode": "raw",
					"raw": "{ \r\n    \"templateName\": \"AxisByop\",\r\n    \"location_id\": \"\",\r\n    \"stepName\": \"Confirm\",\r\n    \"validity\": \"{{validity}}\",\r\n    \"bucketSpec\": [\r\n        {\r\n            \"name\": \"utama\",\r\n            \"quota\": \"5\",\r\n            \"quotaUnits\": \"GB\"\r\n        },\r\n        {\r\n            \"name\": \"{{name}}\",\r\n            \"quota\": \"{{quota_addOn}}\",\r\n            \"quotaUnits\": \"{{quotaUnit_addOn}}\"\r\n        }\r\n        \r\n    ],\r\n    \"addOns\": []\r\n}\r\n",
					"options": {
						"raw": {
							"language": "json"
						}
					}
				},
				"url": {
					"raw": "{{url_byop}}/getByopPrice/?SUBSCRIBER_ID={{entity_id}}&CHANNEL_NAME=AxisNetByop",
					"host": [
						"{{url_byop}}"
					],
					"path": [
						"getByopPrice",
						""
					],
					"query": [
						{
							"key": "SUBSCRIBER_ID",
							"value": "{{entity_id}}"
						},
						{
							"key": "CHANNEL_NAME",
							"value": "AxisNetByop"
						}
					]
				}
			},
			"response": []
		}
	]
}